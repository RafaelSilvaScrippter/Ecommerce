<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>

  <form id="file-env" action="post">
    <input type="file" name="photo" id="photo">
    <button type="submit">submit</button>
  </form>

  <script>
    async function postLogin(nameImg) {
      const response = await fetch("http://localhost:3000/products", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          slug: "fone-de-ouvido",
          name: "Fone de ouvido",
          price: 299.00,
          photo: `./files/${nameImg}`,
          description: "Fone de ouvido sem fio ABS - Apple"
        })
      });

      const dados = await response.json();
      console.log(dados);
    }

    const photoFIle = document.getElementById('photo')
    async function postPhoto() {
      for (photo of photoFIle.files) {

        const response = await fetch("http://localhost:3000/files", {
          method: "POST",
          headers: {
            "Content-Type": "application/octet-stream",
            "x-filename": photo.name
          },
          body: photo
        });

        const dados = await response.json();
        console.log(dados);
      }
    }

    const fileEnv = document.getElementById('file-env')
    fileEnv.addEventListener("submit", (e) => {
      e.preventDefault()
      postPhoto()
      postLogin(photoFIle.files[0].name)
    })


  </script>
</body>

</html>